<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Puntuaciones - Laberinto Educativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath d='M15 15h20v20H15zM65 15h20v20H65zM15 65h20v20H15zM65 65h20v20H65z'/%3E%3C/g%3E%3C/svg%3E");
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        .game-icon {
            position: absolute;
            opacity: 0.1;
            transform-origin: center;
        }
        .rotate-animation {
            animation: rotate 20s linear infinite;
        }
        .float-slow {
            animation: float 6s ease-in-out infinite;
        }
        .float-medium {
            animation: float 4s ease-in-out infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .trophy-glow {
            filter: drop-shadow(0 0 10px rgba(147, 51, 234, 0.3));
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 via-blue-100 to-green-100 min-h-screen bg-pattern relative overflow-hidden">
    <!-- Iconos de fondo animados -->
    <div class="fixed inset-0 pointer-events-none">
        <!-- Trofeo -->
        <svg class="game-icon w-24 h-24 left-1/4 top-1/4 trophy-glow rotate-animation" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2z"/>
        </svg>
        <!-- Libro -->
        <svg class="game-icon w-20 h-20 right-1/4 top-1/3 float-slow" viewBox="0 0 24 24" fill="currentColor">
            <path d="M21 5c-1.1-0.35-2.3-0.5-3.5-0.5-1.7 0-4.15 0.65-5.5 1.5V19c1.35-0.85 3.8-1.5 5.5-1.5 1.2 0 2.4 0.15 3.5 0.5V5z"/>
            <path d="M6.5 4.5C5.3 4.5 4.1 4.65 3 5v14c1.1-0.35 2.3-0.5 3.5-0.5 1.7 0 4.15 0.65 5.5 1.5V6c-1.35-0.85-3.8-1.5-5.5-1.5z"/>
        </svg>
        <!-- Estrella -->
        <svg class="game-icon w-16 h-16 left-1/3 bottom-1/4 rotate-animation" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
        </svg>
        <!-- Cerebro -->
        <svg class="game-icon w-24 h-24 right-1/3 top-1/4 float-medium" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
        </svg>
        <!-- L√°piz -->
        <svg class="game-icon w-20 h-20 left-1/5 bottom-1/3 float-slow" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
        </svg>
        <!-- Rompecabezas -->
        <svg class="game-icon w-24 h-24 right-1/5 bottom-1/4 float-medium" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"/>
        </svg>
        <!-- Medalla -->
        <svg class="game-icon w-16 h-16 right-2/3 top-1/3 rotate-animation" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
        </svg>
    </div>

    <div class="flex flex-col items-center justify-center min-h-screen p-4">
        <div class="text-center bg-white bg-opacity-80 backdrop-blur-md p-8 rounded-2xl shadow-xl w-full max-w-4xl mx-auto relative overflow-hidden border border-white border-opacity-20">
            <!-- Decoraciones de fondo -->
            <div class="absolute top-0 left-0 w-32 h-32 bg-purple-200 rounded-full -translate-x-1/2 -translate-y-1/2 blur-xl"></div>
            <div class="absolute bottom-0 right-0 w-32 h-32 bg-blue-200 rounded-full translate-x-1/2 translate-y-1/2 blur-xl"></div>

            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-8 float-animation">
                üèÜ Sal√≥n de la Fama üåü
            </h1>

            <div id="error-message" class="hidden mb-4 p-4 bg-red-100 text-red-700 rounded-xl"></div>

            <div class="overflow-x-auto relative z-10">
                <table class="w-full text-sm text-left">
                    <thead class="text-lg">
                        <tr class="bg-gradient-to-r from-purple-500 to-blue-500 text-white">
                            <th class="p-4 rounded-tl-xl">üëë Posici√≥n</th>
                            <th class="p-4">ü¶∏‚Äç‚ôÇÔ∏è H√©roe</th>
                            <th class="p-4">‚≠ê Puntos</th>
                            <th class="p-4 rounded-tr-xl">üìÖ Fecha</th>
                        </tr>
                    </thead>
                    <tbody id="scores-body" class="bg-white bg-opacity-50">
                        <!-- Las puntuaciones se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>

            <a href="index.html" 
               class="mt-8 inline-block py-4 px-8 bg-gradient-to-r from-purple-500 to-blue-500 text-white text-lg font-bold rounded-xl hover:from-purple-600 hover:to-blue-600 transform hover:-translate-y-1 transition-all duration-300 shadow-lg hover:shadow-xl">
                üè∞ Volver al Castillo
            </a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const errorMessageElement = document.getElementById('error-message');
            const scoresBody = document.getElementById("scores-body");

            function showError(message) {
                errorMessageElement.textContent = '‚ùå ' + message;
                errorMessageElement.classList.remove('hidden');
                console.error(message);
            }

            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userId = localStorage.getItem('userId');
            const username = localStorage.getItem('username');

            if (!isLoggedIn || !userId || !username) {
                showError('¬°Necesitas iniciar sesi√≥n para ver el Sal√≥n de la Fama!');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }

            try {
                const response = await fetch('http://localhost:4000/api/scores');
                
                if (!response.ok) {
                    throw new Error('No pudimos obtener las puntuaciones');
                }

                const scores = await response.json();
                
                if (!scores || scores.length === 0) {
                    showError('¬°A√∫n no hay h√©roes en el Sal√≥n de la Fama!');
                    return;
                }

                const sortedScores = scores.sort((a, b) => b.score - a.score);

                sortedScores.slice(0, 10).forEach((score, index) => {
                    const row = document.createElement("tr");
                    const position = index + 1;
                    let medal = '';
                    
                    if (position === 1) medal = 'ü•á';
                    else if (position === 2) medal = 'ü•à';
                    else if (position === 3) medal = 'ü•â';
                    
                    row.className = "hover:bg-purple-50 transition-colors border-b border-gray-200" + 
                                  (score.username === username ? " bg-blue-50" : "");
                    
                    row.innerHTML = `
                        <td class="p-4 font-bold">${medal} ${position}¬∞</td>
                        <td class="p-4 font-semibold">${score.username || 'H√©roe Misterioso'}</td>
                        <td class="p-4">${score.score || 0} pts</td>
                        <td class="p-4">${score.date ? new Date(score.date).toLocaleDateString() : 'Tiempo legendario'}</td>
                    `;
                    scoresBody.appendChild(row);
                });

            } catch (error) {
                showError(`¬°Ups! Hubo un problema: ${error.message}`);
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 3000);
            }
        });
    </script>
</body>
</html>